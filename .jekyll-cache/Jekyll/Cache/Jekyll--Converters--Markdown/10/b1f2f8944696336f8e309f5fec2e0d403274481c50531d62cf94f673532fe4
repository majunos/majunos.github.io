I"œ"<p>å¼€å‘ä¸­ä½¿ç”¨åˆ°çš„æŠ€æœ¯ï¼šReact + Redux + Gulp + Browserifyã€‚åˆ©ç”¨<code class="language-plaintext highlighter-rouge">Browserify</code>ï¼Œå¯ä»¥å°†<code class="language-plaintext highlighter-rouge">JSX</code>è½¬åŒ–ä¸º<code class="language-plaintext highlighter-rouge">JS</code>ä»£ç ï¼ŒåŒæ—¶å…è®¸ä½¿ç”¨<code class="language-plaintext highlighter-rouge">require</code>å®ç°é¡¹ç›®çš„æ¨¡å—åŒ–ã€‚<code class="language-plaintext highlighter-rouge">Gulp</code>å®Œæˆä»£ç çš„æ‰“åŒ…ã€‚<code class="language-plaintext highlighter-rouge">Browserify</code>å’Œ<code class="language-plaintext highlighter-rouge">Gulp</code>çš„ç›¸å…³ä»£ç åœ¨<code class="language-plaintext highlighter-rouge">gulpFile.js</code>ä¸­ï¼Œæ¯”è¾ƒç®€å•ï¼Œä¸åœ¨æ­¤èµ˜è¿°ã€‚</p>

<p><img src="http://ikongsong.com/assets/images/posts/react-selector/1.jpg" alt="selector_first" /></p>

<p>é¡¹ç›®ä¸­ï¼Œéœ€è¦å®ç°å››ä¸ªç»„ä»¶ï¼šCanvasComponentã€InputComponentã€ListComponent å’Œ MenuComponentã€‚</p>

<p><img src="http://ikongsong.com/assets/images/posts/react-selector/2.jpg" alt="selector_second" /></p>

<h1 id="redux">Redux</h1>

<hr />

<h2 id="actiontypejs">Action/type.js</h2>

<p>åœ¨<code class="language-plaintext highlighter-rouge">Redux</code>ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">type</code>å‘Šè¯‰<code class="language-plaintext highlighter-rouge">reducer</code>è¿™æ˜¯ä½•ç§<code class="language-plaintext highlighter-rouge">action</code>ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">actionType</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">INSERT_ITEM</span><span class="p">:</span> <span class="dl">'</span><span class="s1">INSERT_ITEM</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">DELETE_ITEM</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DELETE_ITEM</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">DISPLAY_MENU</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DISPLAY_MENU</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">TOGGLE_BTN</span><span class="p">:</span> <span class="dl">'</span><span class="s1">TOGGLE_BTN</span><span class="dl">'</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">actionType</span><span class="p">;</span></code></pre></figure>

<h2 id="actionactionjs">Action/action.js</h2>

<p>æ ¹æ®ä¸Šé¢çš„<code class="language-plaintext highlighter-rouge">type</code>ï¼Œåˆ—å‡ºç›¸åº”çš„<code class="language-plaintext highlighter-rouge">action creator</code>ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./type</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">insertItem</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="nx">type</span><span class="p">.</span><span class="nx">INSERT_ITEM</span><span class="p">,</span>
            <span class="nx">value</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">deleteItem</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="nx">type</span><span class="p">.</span><span class="nx">DELETE_ITEM</span><span class="p">,</span>
            <span class="nx">id</span>
        <span class="p">}</span>
    <span class="p">},</span>
	<span class="c1">// èœå•çš„å±•ç¤ºä¸éšè—</span>
    <span class="na">displayMenu</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="nx">type</span><span class="p">.</span><span class="nx">DISPLAY_MENU</span>
        <span class="p">}</span>
    <span class="p">},</span>
	<span class="c1">// è½¬æ¢æŒ‰é’®çš„çŠ¶æ€</span>
    <span class="na">toggleBtn</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="nx">type</span><span class="p">.</span><span class="nx">TOGGLE_BTN</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span></code></pre></figure>

<h2 id="reducerdatajs">Reducer/data.js</h2>

<p>å­˜å‚¨é»˜è®¤çš„æ•°æ®ï¼Œæ ¼å¼ä¸ºï¼š</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">menuList</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="dl">'</span><span class="s1">value</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">èºç‹®ç²‰</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
	<span class="p">...</span>
<span class="p">];</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">menuList</span><span class="p">;</span></code></pre></figure>

<h2 id="reducerreducerjs">Reducer/reducer.js</h2>

<p>é¦–å…ˆåˆ¤æ–­<code class="language-plaintext highlighter-rouge">localStorage</code>ä¸­æ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œç”¨<code class="language-plaintext highlighter-rouge">data.js</code>ä¸­çš„æ•°æ®åˆå§‹åŒ–ï¼Œè‹¥å­˜åœ¨ï¼Œè¯»å–<code class="language-plaintext highlighter-rouge">localStorage</code>ä¸­çš„æ•°æ®ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">menuList</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./data.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../Action/type.js</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// localStorage</span>
<span class="kd">var</span> <span class="nx">local</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// load data.js</span>
    <span class="na">initLocal</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nb">self</span> <span class="o">=</span>  <span class="k">this</span><span class="p">;</span>
        <span class="nb">self</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">nextId</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">self</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="na">isEmpty</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">set</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">get</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">remove</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="c1">// Copy the data to menuList</span>
    <span class="na">clone</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">copy</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">keySet</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!=</span> <span class="dl">'</span><span class="s1">nextId</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">keySet</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// Reverse order to make the inserted item at the top of the list</span>
        <span class="nx">keySet</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">pre</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="nx">pre</span> <span class="o">-</span> <span class="nx">next</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">keySet</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">copy</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
                <span class="na">id</span><span class="p">:</span> <span class="nx">keySet</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span>
                <span class="na">value</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">keySet</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">copy</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* state = {
        beginSelect: false,
        isMenuShowed: false,
        isEmptyTextShowed: false,
        menuList: [{id: '123', 'value': 'abc'}]
   }
*/</span>
<span class="kd">function</span> <span class="nx">updateState</span><span class="p">(</span><span class="nx">beginSelect</span><span class="p">,</span> <span class="nx">isMenuShowed</span><span class="p">,</span> <span class="nx">isEmptyTextShowed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()){</span>
        <span class="nx">local</span><span class="p">.</span><span class="nx">initLocal</span><span class="p">(</span><span class="nx">menuList</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">beginSelect</span><span class="p">:</span> <span class="nx">beginSelect</span><span class="p">,</span>
        <span class="na">isMenuShowed</span><span class="p">:</span> <span class="nx">isMenuShowed</span><span class="p">,</span>
        <span class="na">isEmptyTextShowed</span><span class="p">:</span> <span class="nx">isEmptyTextShowed</span><span class="p">,</span>
        <span class="na">menuList</span><span class="p">:</span> <span class="nx">local</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
    <span class="p">};</span>
<span class="p">}</span></code></pre></figure>

<p>æ ¹æ®<code class="language-plaintext highlighter-rouge">action</code>çš„<code class="language-plaintext highlighter-rouge">type</code>åšç›¸åº”çš„å¤„ç†ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">reducer</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">state</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">updateState</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">){</span>
        <span class="k">case</span> <span class="nx">type</span><span class="p">.</span><span class="nx">TOGGLE_BTN</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">menuList</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">updateState</span><span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">updateState</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">type</span><span class="p">.</span><span class="nx">DISPLAY_MENU</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">){</span>
                <span class="k">return</span> <span class="nx">updateState</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">,</span> <span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isEmptyTextShowed</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">type</span><span class="p">.</span><span class="nx">DELETE_ITEM</span><span class="p">:</span>
            <span class="nx">local</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">updateState</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isEmptyTextShowed</span><span class="p">);</span>
        <span class="k">case</span> <span class="nx">type</span><span class="p">.</span><span class="nx">INSERT_ITEM</span><span class="p">:</span>
            <span class="nx">local</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">nextId</span><span class="dl">'</span><span class="p">),</span> <span class="nx">action</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
            <span class="nx">local</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">nextId</span><span class="dl">'</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">nextId</span><span class="dl">'</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">updateState</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">reducer</span><span class="p">;</span></code></pre></figure>

<h1 id="react">React</h1>

<hr />

<h2 id="canvasjs">canvas.js</h2>

<p><code class="language-plaintext highlighter-rouge">canvas.js</code>æ¸²æŸ“ä¸»ç•Œé¢ï¼ŒåŒ…å«äººçš„çœ¼ç›ã€å˜´ã€æ˜¾ç¤ºæ¡†å’ŒæŒ‰é’®ã€‚è¯¥ç»„ä»¶éœ€è¦å¤–éƒ¨ä¼ å…¥ä¸‰ä¸ª<code class="language-plaintext highlighter-rouge">props</code>: btnText = {start: â€œxxxâ€, stop: â€œxxâ€}, initText = â€œxxxxâ€, blankText = â€œxxxxâ€ã€‚åˆ†åˆ«è¡¨ç¤ºæŒ‰é’®çš„æ–‡æœ¬ã€æ˜¾ç¤ºæ¡†åˆå§‹æ–‡æœ¬å’Œèœå•æ— æ•°æ®æ—¶çš„æ˜¾ç¤ºæ¡†çš„æ–‡æœ¬ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ReactRedux</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">connect</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../Action/action.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">CanvasComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="na">eyes</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">leftEye</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">x</span><span class="p">:</span> <span class="mi">125</span><span class="p">,</span>
            <span class="na">y</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span>
            <span class="na">radius</span><span class="p">:</span> <span class="mi">40</span>
        <span class="p">},</span>
        <span class="na">rightEye</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">x</span><span class="p">:</span> <span class="mi">265</span><span class="p">,</span>
            <span class="na">y</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span>
            <span class="na">radius</span><span class="p">:</span> <span class="mi">40</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">timer</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">initCanvas</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initText</span><span class="p">,</span> <span class="na">smile</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="na">componentDidUpdate</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nb">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">menuLength</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">menuList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nb">self</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nb">self</span><span class="p">.</span><span class="nx">initCanvas</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="nx">count</span><span class="o">++</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nb">self</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">menuList</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">menuLength</span><span class="p">)].</span><span class="nx">value</span><span class="p">,</span> <span class="na">smile</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
            <span class="p">},</span><span class="mi">100</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isEmptyTextShowed</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">self</span><span class="p">.</span><span class="nx">initCanvas</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nb">self</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">emptyText</span><span class="p">,</span> <span class="na">smile</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="nx">timer</span><span class="p">){</span>
            <span class="nx">clearInterval</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="nx">timer</span><span class="p">);</span>
            <span class="nb">self</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nb">self</span><span class="p">.</span><span class="nx">initCanvas</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nb">self</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">menuList</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">menuLength</span><span class="p">)].</span><span class="nx">value</span><span class="p">,</span> <span class="na">smile</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">self</span><span class="p">.</span><span class="nx">initCanvas</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nb">self</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initText</span><span class="p">,</span> <span class="na">smile</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">drawEyes</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span>  <span class="nx">option</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eyes</span><span class="p">[</span><span class="nx">option</span><span class="p">.</span><span class="nx">direction</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">deg</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">360</span> <span class="o">*</span> <span class="nx">option</span><span class="p">.</span><span class="nx">deg</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">x_offset</span> <span class="o">=</span> <span class="mi">21</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">deg</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">y_offset</span> <span class="o">=</span> <span class="mi">21</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">deg</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="o">=</span><span class="dl">"</span><span class="s2">#fff</span><span class="dl">"</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#fff</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">x</span>  <span class="o">+</span> <span class="nx">x_offset</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">y</span>  <span class="o">+</span> <span class="nx">y_offset</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">radius</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="na">drawMouse</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">option</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span><span class="o">=</span><span class="dl">"</span><span class="s2">#fff</span><span class="dl">"</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">option</span><span class="p">.</span><span class="nx">smile</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mi">195</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mi">195</span><span class="p">,</span> <span class="mi">440</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="na">drawBox</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">option</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">option</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="o">=</span><span class="dl">"</span><span class="s2">#fff</span><span class="dl">"</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">264</span><span class="p">,</span> <span class="mi">275</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">240</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">263</span><span class="p">,</span> <span class="mi">275</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">285</span><span class="p">,</span> <span class="mi">240</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">325</span><span class="p">,</span> <span class="mi">240</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">arcTo</span><span class="p">(</span><span class="mi">345</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">arcTo</span><span class="p">(</span><span class="mi">345</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">arcTo</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">arcTo</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">252</span><span class="p">,</span><span class="mi">240</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#fff</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">32pt Calibri</span><span class="dl">"</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">textAlign</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">center</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">240</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">initCanvas</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">deg</span> <span class="o">=</span> <span class="nx">option</span><span class="p">.</span><span class="nx">count</span><span class="o">*</span> <span class="mi">36</span> <span class="o">+</span> <span class="mi">90</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#82ebc6</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">drawEyes</span><span class="p">({</span><span class="na">ctx</span><span class="p">:</span> <span class="nx">ctx</span><span class="p">,</span> <span class="na">direction</span><span class="p">:</span> <span class="dl">'</span><span class="s1">leftEye</span><span class="dl">'</span><span class="p">,</span> <span class="na">deg</span><span class="p">:</span> <span class="nx">deg</span><span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">drawEyes</span><span class="p">({</span><span class="na">ctx</span><span class="p">:</span> <span class="nx">ctx</span><span class="p">,</span> <span class="na">direction</span><span class="p">:</span> <span class="dl">'</span><span class="s1">rightEye</span><span class="dl">'</span><span class="p">,</span> <span class="na">deg</span><span class="p">:</span> <span class="nx">deg</span><span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">drawMouse</span><span class="p">({</span><span class="na">ctx</span><span class="p">:</span> <span class="nx">ctx</span><span class="p">,</span> <span class="na">smile</span><span class="p">:</span> <span class="nx">option</span><span class="p">.</span><span class="nx">smile</span><span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">drawBox</span><span class="p">({</span><span class="na">ctx</span><span class="p">:</span> <span class="nx">ctx</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">option</span><span class="p">.</span><span class="nx">text</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">currentText</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">btnText</span><span class="p">.</span><span class="nx">stop</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">btnText</span><span class="p">.</span><span class="nx">start</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">canvas-wrapper</span><span class="dl">"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">canvas</span> <span class="nx">ref</span><span class="o">=</span><span class="dl">"</span><span class="s2">canvas</span><span class="dl">"</span> <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">400</span><span class="p">}</span> <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="mi">500</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">btn-wrapper</span><span class="dl">"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">btn-primary</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">currentText</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">mapStateToProps</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">beginSelect</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">beginSelect</span><span class="p">,</span>
        <span class="na">isEmptyTextShowed</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isEmptyTextShowed</span><span class="p">,</span>
        <span class="na">menuList</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">menuList</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">mapDispatchToProps</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">clickHandler</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">toggleBtn</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
    <span class="nx">mapStateToProps</span><span class="p">,</span>
    <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">CanvasComponent</span><span class="p">);</span></code></pre></figure>

<p>å…¶ä¸­<code class="language-plaintext highlighter-rouge">mapStateToProps</code>å°†<code class="language-plaintext highlighter-rouge">state</code>æ˜ å°„ä¸ºç»„ä»¶çš„<code class="language-plaintext highlighter-rouge">props</code>ï¼Œ<code class="language-plaintext highlighter-rouge">mapDispatchToProps</code>å®ç°<code class="language-plaintext highlighter-rouge">action</code>çš„åˆ†å‘ã€‚</p>

<h2 id="listjs">list.js</h2>

<p><code class="language-plaintext highlighter-rouge">list.js</code>å±•ç°èœå•ä¸­çš„ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶å¯å®ç°è¯¥æ•°æ®çš„åˆ é™¤ã€‚è¯¥ç»„ä»¶éœ€è¦å¤–éƒ¨ä¼ å…¥çš„<code class="language-plaintext highlighter-rouge">props</code>ä¸ºï¼šlistText = â€œxxxâ€ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ReactRedux</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">connect</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../Action/action.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ListComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">menu-item</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">listText</span><span class="p">}</span><span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">btn-delete</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">deleteHandler</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">i</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">icon-trash icon-large</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;&lt;/</span><span class="nx">span</span><span class="o">&gt;&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>


<span class="kd">function</span> <span class="nx">mapDispatchToProps</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">ownProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">deleteHandler</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">deleteItem</span><span class="p">(</span><span class="nx">ownProps</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
    <span class="kc">null</span><span class="p">,</span>
    <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">ListComponent</span><span class="p">);</span></code></pre></figure>

<h2 id="inputjs">input.js</h2>

<p><code class="language-plaintext highlighter-rouge">input.js</code>å®ç°äº†ä¸ºèœå•åˆ—è¡¨æ·»åŠ æ•°æ®çš„åŠŸèƒ½ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ReactRedux</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">connect</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../Action/action.js</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">inputValue</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">InputComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="na">handleChange</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">inputValue</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">input-wrapper</span><span class="dl">"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">input-add</span><span class="dl">"</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">menu-input</span><span class="dl">"</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleChange</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">btn-add</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">addHandler</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Add</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">mapDispatchToProps</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">addHandler</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">insertItem</span><span class="p">(</span><span class="nx">inputValue</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
    <span class="kc">null</span><span class="p">,</span>
    <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">InputComponent</span><span class="p">);</span></code></pre></figure>

<h2 id="menujs">menu.js</h2>

<p><code class="language-plaintext highlighter-rouge">menu.js</code>è°ƒç”¨<code class="language-plaintext highlighter-rouge">input.js</code>å’Œ<code class="language-plaintext highlighter-rouge">list.js</code>ï¼Œä¸ºç”¨æˆ·å±•ç¤ºå¤‡é€‰æ•°æ®ï¼ŒåŒæ—¶åŒ…å«ä¸€ä¸ªç‚¹å‡»æŒ‰é’®ï¼Œå®ç°èœå•çš„å±•ç¤ºä¸éšè—ã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ReactRedux</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">connect</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../Action/action.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ListComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./list</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">InputComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./input</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">MenuComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">menuDisplay</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">?</span> <span class="dl">'</span><span class="s1">block</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">icon</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">?</span> <span class="dl">'</span><span class="s1">icon-arrow-right</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">icon-arrow-left</span><span class="dl">'</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">menu-wrapper</span><span class="dl">"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">btn-menu</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">i</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">icon</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">menu-body</span><span class="dl">"</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="o">/</span><span class="p">{</span><span class="na">display</span><span class="p">:</span> <span class="nx">menuDisplay</span><span class="p">}</span><span class="sr">/}</span><span class="err">&gt;
</span>                    <span class="o">&lt;</span><span class="nx">InputComponent</span><span class="o">/&gt;</span>
                    <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">menu-detail</span><span class="dl">"</span><span class="o">&gt;</span>
                        <span class="p">{</span>
                            <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">menuList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
                                <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ListComponent</span> <span class="nx">listText</span> <span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span> <span class="nx">key</span> <span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span> <span class="nx">id</span> <span class="o">=</span> <span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="sr">/&gt;</span><span class="err">;
</span>                            <span class="p">})</span>
                        <span class="p">}</span>
                    <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">mapStateToProps</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">isMenuShowed</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isMenuShowed</span><span class="p">,</span>
        <span class="na">menuList</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">menuList</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">mapDispatchToProps</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">clickHandler</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">displayMenu</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
    <span class="nx">mapStateToProps</span><span class="p">,</span>
    <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">MenuComponent</span><span class="p">);</span></code></pre></figure>

<h2 id="mainjs">main.js</h2>

<p><code class="language-plaintext highlighter-rouge">main.js</code>å®ç°æœ€ç»ˆçš„å±•ç¤ºã€‚</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ReactDOM</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-dom</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Redux</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">redux</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ReactRedux</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Provider</span> <span class="o">=</span> <span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">Provider</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">createStore</span> <span class="o">=</span> <span class="nx">Redux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Reducer/reducer.js</span><span class="dl">'</span><span class="p">);</span>


<span class="c1">// Store</span>
<span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MenuComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Component/menu.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">CanvasComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Component/canvas.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">MenuComponent</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">CanvasComponent</span> <span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">canvas-wrapper</span><span class="dl">'</span> <span class="nx">btnText</span> <span class="o">=</span> <span class="p">{</span><span class="o">/</span><span class="p">{</span><span class="na">start</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Start</span><span class="dl">'</span><span class="p">,</span> <span class="na">stop</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Stop</span><span class="dl">'</span><span class="p">}</span><span class="sr">/} initText = 'åƒä»€ä¹ˆ</span><span class="se">?</span><span class="sr">' emptyText = "èœå•ç©ºç©ºå¦‚ä¹Ÿ"/</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/Provider</span><span class="err">&gt;
</span>    <span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">main-wrapper</span><span class="dl">'</span><span class="p">));</span></code></pre></figure>

<p>ä¸ºäº†è®©æ‰€æœ‰ç»„ä»¶éƒ½èƒ½è·å–åˆ°<code class="language-plaintext highlighter-rouge">store</code>ï¼Œæ ¹ç»„ä»¶å¿…é¡»åŒ…è£¹åœ¨<code class="language-plaintext highlighter-rouge">Provider</code>ä¸­ï¼Œå¹¶å°†<code class="language-plaintext highlighter-rouge">store</code>ä½œä¸ºå‚æ•°ä¼ ç»™<code class="language-plaintext highlighter-rouge">Provider</code>ã€‚</p>

<h1 id="å…¶å®ƒ">å…¶å®ƒ</h1>

<hr />

<p>é¡¹ç›®ä¸­æ‰€ç”¨çš„<code class="language-plaintext highlighter-rouge">CSS</code>å’Œ<code class="language-plaintext highlighter-rouge">HTML</code>åœ¨æ­¤å°±ä¸è´´å‡ºæ¥äº†ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸ºäº†èƒ½å¤Ÿåœ¨ PC ç«¯å’Œç§»åŠ¨ç«¯éƒ½æœ‰è‰¯å¥½çš„å±•ç¤ºæ•ˆæœï¼Œ<code class="language-plaintext highlighter-rouge">HTML</code>ä¸­è®¾ç½®<code class="language-plaintext highlighter-rouge">initial-scale</code>ä¸º 0.8ï¼ˆæ ¹æ®canvaså¤§å°å’Œä¸åŒæœºå‹çš„åˆ†è¾¨ç‡æ‰€è®¡ç®—å¾—åˆ°ï¼‰ã€‚</p>

<p><a href="https://github.com/songkong/Selector">å®Œæ•´ä»£ç </a></p>

<p><a href="http://selector.ikongsong.com">é¡¹ç›®å±•ç¤º</a></p>
:ET